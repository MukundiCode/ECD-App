package com.example.ecd_app

import androidx.test.core.app.ActivityScenario
import androidx.test.ext.junit.runners.AndroidJUnit4
import com.example.ecd_app.retrofit.PostJS
import com.example.ecd_app.retrofit.RetrofitService
import com.example.ecd_app.retrofit.WordPressEcdAPI
import io.reactivex.android.schedulers.AndroidSchedulers
import io.reactivex.disposables.CompositeDisposable
import io.reactivex.schedulers.Schedulers
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.runBlocking
import kotlinx.serialization.ExperimentalSerializationApi
import okhttp3.OkHttpClient
import okhttp3.mockwebserver.MockResponse
import okhttp3.mockwebserver.MockWebServer
import org.junit.After
import org.junit.Assert.*
import org.junit.Before
import org.junit.Test
import org.junit.runner.RunWith
import retrofit2.Retrofit
import retrofit2.adapter.rxjava2.RxJava2CallAdapterFactory
import retrofit2.converter.gson.GsonConverterFactory
import java.io.File
import java.net.HttpURLConnection
import java.util.concurrent.Executors
import java.util.concurrent.TimeUnit

/**
 * @author Tinashe Mukundi Chitamba
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
@RunWith(AndroidJUnit4::class)
@ExperimentalCoroutinesApi
@ExperimentalSerializationApi
class RetrofitCallTest {
    private val mockWebServer = MockWebServer()
    private lateinit var client : OkHttpClient
    private lateinit var api: WordPressEcdAPI

    /**
     * Setup mockito
     *
     */
    @Before
    fun setup(){
        mockWebServer.start(8000)
        client = OkHttpClient.Builder()
            .build()

        api = Retrofit.Builder()
            .baseUrl(mockWebServer.url("/"))
            .addCallAdapterFactory(RxJava2CallAdapterFactory.create())
            .addConverterFactory(GsonConverterFactory.create(RetrofitService.ServiceBuilder.gson))
            .callbackExecutor(Executors.newSingleThreadExecutor())
            .client(client)
            .build()
            .create(WordPressEcdAPI::class.java)

        val response: MockResponse = MockResponse()
            .setResponseCode(HttpURLConnection.HTTP_OK)
            .addHeader("Content-Type", "application/json; charset=utf-8")
            .addHeader("Cache-Control", "no-cache")
            .setBody("[{\"post\":{\"ID\":164,\"post_author\":\"1\",\"post_date\":\"2022-08-08 07:22:46\",\"post_date_gmt\":\"2022-08-08 07:22:46\",\"post_content\":\"<!-- wp:video {\\\"id\\\":134} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/Using-a-crate-to-help-baby-with-sitting.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Using a crate to help baby with sitting\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"using-a-crate-to-help-baby-with-sitting\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:39\",\"post_modified_gmt\":\"2022-08-18 05:54:39\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=164\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Assigned Content\"},{\"post\":{\"ID\":145,\"post_author\":\"1\",\"post_date\":\"2022-07-29 10:24:05\",\"post_date_gmt\":\"2022-07-29 10:24:05\",\"post_content\":\"<!-- wp:video {\\\"id\\\":139} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/Massage-of-baby-with-tight-arms-and-legs.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Massage of a baby with tight arms and legs\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"massage-of-a-baby-with-tight-arms-and-legs\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:39\",\"post_modified_gmt\":\"2022-08-18 05:54:39\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=145\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Assigned Content\"},{\"post\":{\"ID\":83,\"post_author\":\"1\",\"post_date\":\"2022-06-15 13:44:12\",\"post_date_gmt\":\"2022-06-15 13:44:12\",\"post_content\":\"<!-- wp:video {\\\"id\\\":76} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/06\\/yt5s.com-Breastfeeding-in-the-Workplace.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Breastfeeding in the Workplace\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"breastfeeding-in-the-workplace\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=83\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":96,\"post_author\":\"1\",\"post_date\":\"2022-07-18 08:02:04\",\"post_date_gmt\":\"2022-07-18 08:02:04\",\"post_content\":\"<!-- wp:video {\\\"id\\\":90} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/Things-to-do-at-Home_vid.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Things to do at home\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"things-to-do-at-home\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=96\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Development\"},{\"post\":{\"ID\":111,\"post_author\":\"1\",\"post_date\":\"2022-07-25 08:12:25\",\"post_date_gmt\":\"2022-07-25 08:12:25\",\"post_content\":\"<!-- wp:video {\\\"id\\\":110} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/yt5s.com-The-Road-to-Health_-The-Benefits-of-Breastfeeding.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"The Road to Health Benefits of Breastfeeding\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"the-road-to-health-benefits-of-breastfeeding\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:56:09\",\"post_modified_gmt\":\"2022-08-18 05:56:09\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=111\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":72,\"post_author\":\"1\",\"post_date\":\"2022-06-15 13:18:45\",\"post_date_gmt\":\"2022-06-15 13:18:45\",\"post_content\":\"<!-- wp:video {\\\"id\\\":73} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/06\\/benefits_vid.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Benefits of Breastfeeding\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"benefits-of-breastfeeding\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=72\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":79,\"post_author\":\"1\",\"post_date\":\"2022-06-15 13:39:49\",\"post_date_gmt\":\"2022-06-15 13:39:49\",\"post_content\":\"<!-- wp:video {\\\"id\\\":77} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/06\\/expression_vid.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Breast Milk Expression\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"breast-milk-expression\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=79\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":81,\"post_author\":\"1\",\"post_date\":\"2022-06-15 13:41:32\",\"post_date_gmt\":\"2022-06-15 13:41:32\",\"post_content\":\"<!-- wp:video {\\\"id\\\":75} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/06\\/Food_vid.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Food to Eat while Breastfeeding\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"food-to-eat-while-breastfeeding\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=81\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":82,\"post_author\":\"1\",\"post_date\":\"2022-06-15 13:43:11\",\"post_date_gmt\":\"2022-06-15 13:43:11\",\"post_content\":\"<!-- wp:video {\\\"id\\\":78} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/06\\/storage.vid_.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Storing Breast Milk from Breastfeeding\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"storing-breast-milk-from-breastfeeding\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:03:18\",\"post_modified_gmt\":\"2022-08-18 06:03:18\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=82\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":143,\"post_author\":\"1\",\"post_date\":\"2022-07-29 10:22:13\",\"post_date_gmt\":\"2022-07-29 10:22:13\",\"post_content\":\"<!-- wp:video {\\\"id\\\":132} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/Making-your-own-book-for-baby.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Making your own book for your baby\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"making-your-own-book-for-your-baby\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:39\",\"post_modified_gmt\":\"2022-08-18 05:54:39\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=143\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Development\"},{\"post\":{\"ID\":146,\"post_author\":\"12\",\"post_date\":\"2022-07-29 10:24:55\",\"post_date_gmt\":\"2022-07-29 10:24:55\",\"post_content\":\"<!-- wp:video {\\\"id\\\":141} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/07\\/Mom-talking-about-corrected-age-for-her-prem-baby.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Mom talking about corrected age for her prem baby\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"mom-talking-about-corrected-age-for-her-prem-baby\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:39\",\"post_modified_gmt\":\"2022-08-18 05:54:39\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=146\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Development\"},{\"post\":{\"ID\":181,\"post_author\":\"1\",\"post_date\":\"2022-08-12 08:04:28\",\"post_date_gmt\":\"2022-08-12 08:04:28\",\"post_content\":\"<!-- wp:image {\\\"id\\\":183,\\\"sizeSlug\\\":\\\"large\\\",\\\"linkDestination\\\":\\\"none\\\"} -->\\n<figure class=\\\"wp-block-image size-large\\\"><img src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/Helplines-459x1024.png\\\" alt=\\\"\\\" class=\\\"wp-image-183\\\"\\/><\\/figure>\\n<!-- \\/wp:image -->\",\"post_title\":\"Parent Helplines\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"parent-helplines\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:39\",\"post_modified_gmt\":\"2022-08-18 05:54:39\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=181\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Parent Health\"},{\"post\":{\"ID\":185,\"post_author\":\"1\",\"post_date\":\"2022-08-12 09:23:06\",\"post_date_gmt\":\"2022-08-12 09:23:06\",\"post_content\":\"<!-- wp:video {\\\"id\\\":184} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/Childdevelopment.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Child Development\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"child-development\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:54:38\",\"post_modified_gmt\":\"2022-08-18 05:54:38\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=185\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Development\"},{\"post\":{\"ID\":186,\"post_author\":\"1\",\"post_date\":\"2022-08-12 09:33:54\",\"post_date_gmt\":\"2022-08-12 09:33:54\",\"post_content\":\"<!-- wp:video {\\\"id\\\":203} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/The-Road-to-Health_-Celebrating-Children-with-Differences.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\\n\\n<!-- wp:paragraph -->\\n<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nibh sed pulvinar proin gravida. Mauris sit amet massa vitae tortor. In nulla posuere sollicitudin aliquam ultrices sagittis orci a. Semper feugiat nibh sed pulvinar proin. Turpis in eu mi bibendum neque egestas congue. Nulla porttitor massa id neque aliquam vestibulum. Aliquet eget sit amet tellus cras. Quis auctor elit sed vulputate. Nulla malesuada pellentesque elit eget gravida cum sociis natoque penatibus. Massa tincidunt dui ut ornare lectus. Placerat duis ultricies lacus sed turpis tincidunt id. Odio aenean sed adipiscing diam.<\\/p>\\n<!-- \\/wp:paragraph -->\",\"post_title\":\"Celebrating children with differences\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"celebrating-children-with-differences\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:00:32\",\"post_modified_gmt\":\"2022-08-18 06:00:32\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=186\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Development\"},{\"post\":{\"ID\":187,\"post_author\":\"1\",\"post_date\":\"2022-08-12 09:51:57\",\"post_date_gmt\":\"2022-08-12 09:51:57\",\"post_content\":\"<!-- wp:file {\\\"id\\\":189,\\\"href\\\":\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/childimmunizationsposter.pdf\\\",\\\"displayPreview\\\":true} -->\\n<div class=\\\"wp-block-file\\\"><object class=\\\"wp-block-file__embed\\\" data=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/childimmunizationsposter.pdf\\\" type=\\\"application\\/pdf\\\" style=\\\"width:100%;height:600px\\\" aria-label=\\\"Embed of childimmunizationsposter.\\\"><\\/object><a id=\\\"wp-block-file--media-17bce01e-2b2a-4670-9577-ca41be05e74e\\\" href=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/childimmunizationsposter.pdf\\\">childimmunizationsposter<\\/a><a href=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/childimmunizationsposter.pdf\\\" class=\\\"wp-block-file__button\\\" download aria-describedby=\\\"wp-block-file--media-17bce01e-2b2a-4670-9577-ca41be05e74e\\\">Download<\\/a><\\/div>\\n<!-- \\/wp:file -->\",\"post_title\":\"Immunization Poster\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"immunization-poster\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:56:01\",\"post_modified_gmt\":\"2022-08-18 05:56:01\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=187\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":191,\"post_author\":\"1\",\"post_date\":\"2022-08-12 18:40:35\",\"post_date_gmt\":\"2022-08-12 18:40:35\",\"post_content\":\"<!-- wp:video {\\\"id\\\":192} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/Immunization-and-its-Importance.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Immunization and its Importance\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"immunization-and-its-importance\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:00:25\",\"post_modified_gmt\":\"2022-08-18 06:00:25\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=191\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":193,\"post_author\":\"1\",\"post_date\":\"2022-08-12 18:41:37\",\"post_date_gmt\":\"2022-08-12 18:41:37\",\"post_content\":\"<!-- wp:video {\\\"id\\\":194} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/Danger-Signs-in-Early-Childhood.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Danger Signs in Early Childhood\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"danger-signs-in-early-childhood\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:00:19\",\"post_modified_gmt\":\"2022-08-18 06:00:19\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=193\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":195,\"post_author\":\"1\",\"post_date\":\"2022-08-12 18:44:19\",\"post_date_gmt\":\"2022-08-12 18:44:19\",\"post_content\":\"<!-- wp:video {\\\"id\\\":196} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/Love-Listening-and-Explaining.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"Love listening and explaining\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"love-listening-and-explaining\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 06:00:10\",\"post_modified_gmt\":\"2022-08-18 06:00:10\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=195\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"},{\"post\":{\"ID\":197,\"post_author\":\"1\",\"post_date\":\"2022-08-12 18:45:42\",\"post_date_gmt\":\"2022-08-12 18:45:42\",\"post_content\":\"<!-- wp:video {\\\"id\\\":198} -->\\n<figure class=\\\"wp-block-video\\\"><video controls src=\\\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/wp-content\\/uploads\\/2022\\/08\\/About-Road-to-Health.mp4\\\"><\\/video><\\/figure>\\n<!-- \\/wp:video -->\",\"post_title\":\"About the Road to Health Book\",\"post_excerpt\":\"\",\"post_status\":\"publish\",\"comment_status\":\"closed\",\"ping_status\":\"closed\",\"post_password\":\"\",\"post_name\":\"about-the-road-to-health-book\",\"to_ping\":\"\",\"pinged\":\"\",\"post_modified\":\"2022-08-18 05:59:57\",\"post_modified_gmt\":\"2022-08-18 05:59:57\",\"post_content_filtered\":\"\",\"post_parent\":0,\"guid\":\"https:\\/\\/wordpress-729091-2804560.cloudwaysapps.com\\/?post_type=ecd_content&#038;p=197\",\"menu_order\":0,\"post_type\":\"ecd_content\",\"post_mime_type\":\"\",\"comment_count\":\"0\",\"filter\":\"raw\"},\"category\":\"Baby Health\"}]")
        mockWebServer.enqueue(response)
    }

    @After
    fun tearDown() {
        mockWebServer.shutdown()
    }

    /**
     * Test size of list returned
     *
     */
    @Test
    fun testPostListSize() {
        runBlocking {
            val actual =  api.getPosts("Test").blockingFirst()
            assertEquals(19, actual.size)
        }
    }

    /**
     * Tests that the titles are maintained when consumed
     *
     */
    @Test
    fun testPostTestTitle(){
        runBlocking {
            val actual =  api.getPosts("Test").blockingFirst()
            assertEquals("Using a crate to help baby with sitting",actual.get(0).post!!.postTitle)
        }
    }

    /**
     * Tests that category name is maintained
     *
     */
    @Test
    fun testPostCategory(){
        runBlocking {
            val actual =  api.getPosts("Test").blockingFirst()
            assertEquals("Assigned Content",actual.get(0).category)
        }
    }

    /**
     * Test methoda that extracts link from post
     *
     */
    @Test
    fun testLinkExtraction(){
        runBlocking {
            val actual =  api.getPosts("Test").blockingFirst()
            ActivityScenario.launch(MainActivity::class.java).onActivity { activity ->
                var testLink = actual.get(0).post!!.postContent?.let { activity.getVideoLink(it) }
                assertEquals("https://wordpress-729091-2804560.cloudwaysapps.com/wp-content/uploads/2022/07/Using-a-crate-to-help-baby-with-sitting.mp4",testLink)
            }

        }
    }

}
